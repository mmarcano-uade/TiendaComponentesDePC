<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="styles.css">
    <title>Fullgarden</title>
</head>
<body>
<header>
     <nav class="navbar navbar-expand-lg bg-white fixed-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="index.html">
                <i class="logo-mask" aria-hidden="true"></i>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
                    aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-end" id="mainNav">
                <ul class="navbar-nav align-items-lg-center gap-lg-3">
                    <li class="nav-item">
                        <a class="nav-link fw-semibold" href="index.html#nosotros">Nosotros</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link fw-semibold" href="products.html">Productos</a>
                    </li>
                      <li class="nav-item">
                        <a class="nav-link fw-semibold" href="promociones.html">Promociones</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link fw-semibold" href="#contacto">Contacto</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<main>
  <div class="container mt-6">
      <div class="card mb-4 border-0 shadow-sm bg-light">
          <div class="card-body d-flex flex-column flex-md-row align-items-center justify-content-between">
              <div>
                  <h5 class="card-title mb-1 fw-bold">ðŸ”¥ Ofertas en todas las compras</h5>
                  <p class="card-text mb-2 mb-md-0">
                      Hasta <span class="fw-bold text-danger">10% OFF</span> en compras superiores a 30.000$ Â· Â¡SÃ³lo por tiempo limitado!
                  </p>
              </div>
              <a href="products.html" class="btn btn-dark px-4 mt-2 mt-md-0">Comprar ahora</a>
          </div>
      </div>
      <div class="row  pt-5 pb-5 frame-container">
            <div class="col-md-8 col-sm-12">
                <aside>
                <div class="col text-center">
                <div class="row gap-2 justify-content-center" id="productContainerRender"></div>
                </div>
            </aside>  
        
            </div>
            <div class="col">
                <section id="results" class="mt-3">
                    <h1>Resumen</h1>
                    <h5><strong>Total sin descuento:</strong> <span id="subtotal">$0</span></h5>
                    <hr size="4px" color="#e6e6e6">


                    <ul id="discountsBreakdown"></ul>

                    <div class="card mb-4 border-0 shadow-sm" style="background-color: #0F1F2F;">
                        <div id="threshold"></div>
                    </div>
                    <h3>Descuentos: <span id="discountsTotal" style="color:red">$0</h3>

                    <hr size="4px" color="#e6e6e6">

                    <h2>Total final: <span id="finalTotal">$0</span></h2>
                </section>
            </div>
        
        </div>
  </div>
</main>
<footer class="mt-5">
    <div class="container" id="contacto">
        <div class="row">
            <div class="col-md-5 mb-4">
                <h2 class="mb-3">UbicaciÃ³n & Contacto</h2>
                <p><i class="bi bi-geo-alt-fill "></i> Galerias jardin, Microcentro, CABA</p>
                <p><i class="bi bi-telephone-fill "></i> (11) 8888-7890</p>
                <p><i class="bi bi-envelope-fill "></i> info@fullgarden.com</p>
                <div class="mt-3">
                    <a href="#" class="text-dark me-3"><i class="bi bi-facebook fs-4"></i></a>
                    <a href="#" class="text-dark me-3"><i class="bi bi-twitter fs-4"></i></a>
                    <a href="#" class="text-dark"><i class="bi bi-instagram fs-4"></i></a>
                </div>
                <div class="mt-4">
                    <iframe src="https://maps.google.com/maps?q=Buenos%20Aires&t=&z=13&ie=UTF8&iwloc=&output=embed"
                            width="100%" height="200" style="border:0;" allowfullscreen="" loading="lazy">
                    </iframe>
                </div>
            </div>

            <div class="col-md-7">
                <h2 class="mb-3">EnvÃ­anos un mensaje</h2>
                <form>
                    <div class="mb-3">
                        <label for="nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="nombre" placeholder="Tu nombre" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Correo</label>
                        <input type="email" class="form-control" id="email" placeholder="correo@ejemplo.com" required>
                    </div>
                    <div class="mb-3">
                        <label for="asunto" class="form-label">Asunto</label>
                        <select id="asunto" class="form-select" required>
                            <option selected disabled value="">Selecciona...</option>
                            <option value="consulta">Consulta</option>
                            <option value="soporte">Soporte</option>
                            <option value="presupuesto">Presupuesto</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="mensaje" class="form-label">Mensaje</label>
                        <textarea class="form-control" id="mensaje" rows="5" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary px-4">Enviar</button>
                </form>
            </div>
        </div>
    </div>
</footer>

<script>
    const navbar = document.querySelector('nav');
    const THRESHOLD = 60; // px

    function onScroll() {
        if (window.scrollY > THRESHOLD) {
            navbar.classList.add('is-scrolled');
        } else {
            navbar.classList.remove('is-scrolled');
        }
    }

    let ticking = false;
    window.addEventListener('scroll', () => {
        if (!ticking) {
            window.requestAnimationFrame(() => { onScroll(); ticking = false; });
            ticking = true;
        }
    });
    onScroll();
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script src="products.js"></script>


<script>
    var THRESHOLD_DISCOUNT = 200_000
    const cart = {};
</script>

<script>
    function fmtARS(n){
        return typeof n === "number"
            ? n.toLocaleString("es-AR", { style: "currency", currency: "ARS", maximumFractionDigits: 0 })
            : "$0";
    }

    function discountPerItem(product, qty) {
        if (!qty || qty <= 0) return 0;
        const price = product.price || 0;

        switch (product.promotion) {
            case "2x50OFF": {
                if (qty <= 0) return 0;
                const pairs = Math.floor(qty / 2); 
                return pairs * (price * 0.5);    
            }
            case "3x2OFF": {
                const trios = Math.floor(qty / 3);
                return trios * price;
            }
            default:
                return 0;
        }
    }

    function calculateCart(cartMap) {
        let subtotal = 0;
        let itemDiscount = 0;
        const itemBreakdown = [];

        products.forEach((p) => {
            const qty = cartMap[p.id] || 0;
            if (qty > 0) {
            const line = p.price * qty;
            const disc = discountPerItem(p, qty);
            subtotal += line;
            itemDiscount += disc;
            // if (disc > 0) {
                itemBreakdown.push({
                    id: p.id,
                    name: p.name,
                    detail: promoLabel(p.promotion),
                    amount: disc,
                });
            // }
            }
        });
        const afterItem = subtotal - itemDiscount;
        const thresholdApplies = subtotal >= THRESHOLD_DISCOUNT;
        const thresholdDiscount = thresholdApplies ? afterItem * 0.10 : 0;

        const totalDiscount = itemDiscount + thresholdDiscount;
        const finalTotal = subtotal - totalDiscount;

        return {
            subtotal,
            itemDiscount,
            itemBreakdown,
            thresholdDiscount,
            totalDiscount,
            finalTotal,
        };
    }

    function promoLabel(code){
        switch (code) {
            case "2x50OFF": return "LlevÃ¡ 2 y 50% en la 2da";
            case "3x2OFF": return "Promo 3Ã—2";
            default: return "";
        }
    };

    function hookInteractions() {
        products.forEach((p) => {
            const input = document.getElementById(`qty-${p.id}`);
            if (input) {
            input.addEventListener("input", () => {
                const qty = Math.max(0, parseInt(input.value, 10) || 0);
                console.log(qty)
                cart[p.id] = qty;
                refreshTotals();
            });
            }
        });
    }

    function refreshTotals() {
        const r = calculateCart(cart);
        document.getElementById("subtotal").textContent = fmtARS(r.subtotal);
        document.getElementById("discountsTotal").textContent = fmtARS(r.totalDiscount);
        document.getElementById("finalTotal").textContent = fmtARS(r.finalTotal);
        const div = document.getElementById("threshold");
        div.innerHTML = ""
        const ul = document.getElementById("discountsBreakdown");
        ul.innerHTML = "";
        r.itemBreakdown.forEach((d) => {
            const li = document.createElement("li");
            const span = document.createElement("span");
            span.style.color = "red"
            span.textContent = ` âˆ’${fmtARS(d.amount)}`
            li.textContent = `${d.name} â€” ${d.detail}: `;
            li.appendChild(span)
            ul.appendChild(li);
        });
        if (r.thresholdDiscount > 0) {
            div.className="card-body d-flex flex-column flex-md-row align-items-center justify-content-between"
            const h5 = document.createElement("h6");
            const span = document.createElement("span");
            span.style.color = "red"
            h5.style.color = "#ffffff"
            h5.textContent = `10% por compras superiores a ${fmtARS(THRESHOLD_DISCOUNT)}:`;
            span.textContent = ` âˆ’${fmtARS(r.thresholdDiscount)}`
            h5.appendChild(span)
            div.appendChild(h5);
        }
    }
</script>

<script>
  hookInteractions();
  refreshTotals();
</script>

</body>
</html>